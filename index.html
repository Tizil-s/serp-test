<!-- Result -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<stl_head>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9PVRG9FM5M"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-9PVRG9FM5M');
</script>

<script language="JavaScript" type="text/javascript" src="<tag:jssource />"></script>
<title><tag:domain_name /></title>
<meta http-equiv="Content-Type" content="text/html; charset=<tag:charset />">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<tag:reset_css />
<style type="text/css">
body{background:#fff; font-family: <tagd:style name="SerpContentText" value="roboto-medium" type="font-family" />, Arial, sans-serif;}
b,strong{font-weight: normal;}
.d-flex{display: flex;}
.justify-content-space-between{justify-content: space-between;} 

.desktopContainer{padding: 22px 28px 20px; flex-wrap: wrap;flex-direction: column; gap: 10px;display: flex;width: 100%;}
.container .top_wrap{max-width: 400px; margin: 0 auto;}
.container .top_wrap, .container .bottom_wrap{width: 100%;}
.container .top_wrap .image_wrap{position: relative; width: 100%; height:350px; }
.container .bottom_wrap .list_1{margin: 10px 0;}
.main-anchor{display: block; position:relative; overflow:hidden;word-wrap:break-word;
background: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAFoEvQfAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAA1JREFUeNpj+P//PwMACPwC/njEsrAAAAAASUVORK5CYII=') right top no-repeat; padding: 0;}

li a.main-anchor{padding: 18px 24px 30px 40px; } 
    
li{position: relative;} 
li .content{display: flex; align-items: center; justify-content: space-between; overflow: hidden;}
li .content .left_content{overflow: hidden; }
li .content .right_content{position: relative;}

li .content .url{font-size: 24px; line-height:28px;  color:<tagd:style name="SerpAdUrl" value="#16527E" type="color" />;}
li .content .title{margin: 20px 0; font-size: 48px; line-height: 70px; color:<tagd:style name="SerpAdTitle" value="#000" type="color" />;
font-family: <tagd:style name="SerpAdTitle" value="Roboto-Bold" type="font-family" />, Arial, sans-serif;}
li .content .desc{font-size: 24px; line-height:28px; 
    color:<tagd:style name="SerpAdDescription" value="#798085" type="color" />;
}
.arrow_wrap_outer,li .content .arrow_wrap_inner{position: relative;width: 100%; height: 78px; background: <tagd:style name="SerpAdCTABackground" value="#196FCF" type="color" />; border-radius: 10px; font-size: 32px; color: <tagd:style name="SerpAdCTAText" value="#fff" type="color" />;; text-align: center; line-height: 78px; overflow: hidden;}
.arrow_wrap_outer{position: relative;}
.arrow_wrap_outer .arrow, li .content .arrow_wrap_inner .arrow{position: absolute; width: 78px; height:78px;  background: <tagd:style name="SerpAdCTAArrowBackground" value="#498CD9" type="color" />;  color: <tagd:style name="SerpAdCTAText" value="#fff" type="color" />;font-size: 32px; right:0; top:0; line-height: 78px; border-radius: 0 10px 10px 0; }

li .content .arrow_wrap_inner .arrow_text.nxt{display: none;}

li .content .arrow_wrap_inner{ width: 487px;}
li .content .arrow_wrap_inner .arrow{ background: <tagd:style name="SerpAdCTAArrowBackground" value="#597DB7" type="color" />;}


.arrow_text{max-width: calc(100% - 78px);}
.parentContainer{
    display: flex;
    flex-direction: row;
    align-items: center;
    gap: 10px;
    border: 1px solid <tagd:style name="SerpAdBorder" value="#AAA" type="color" />;  
    background: <tagd:style name="SerpAdBackground" value="" type="color" />;
}
@media screen and (min-width:2000px) {
    li .content .title{font-size: 54px; }
li .content .desc{font-size: 32px; line-height: 42px;}

}
@media screen and (max-width:1149px) {
li .content .left_content{width: calc(100% - 370px);}
li .content .arrow_wrap_inner{width: 350px;}
.parentContainer{flex-direction: column;border: none; }
li{position: relative;     border: 1px solid <tagd:style name="SerpAdBorder" value="#AAA" type="color" />;  
} 
}

@media screen and (max-width:899px) {
.parentContainer{flex-direction: column;border:none;}    
li .content{flex-wrap: wrap;}
li .content .left_content,li .content .right_content,li .content .arrow_wrap_inner{width: 100%;}
li .content .desc{margin-bottom: 20px;}

}

/* @media screen and (max-width:599px) {
.container .top_wrap .image_wrap{position: relative; width: 345px; height:236px; margin: 0 auto; }
.container .bottom_wrap .list_1{margin: 10px 0 22px;}
li a.main-anchor{padding: 37px 16px 37px;}
li .content .url{font-size: 14px; line-height:17px;}
li .content .title{margin: 10px 0; font-size: 20px; line-height: 26px;}
li .content .desc{font-size: 14px; line-height:17px; margin-bottom: 0px;} 
li .content .arrow_wrap_inner{height:38px; line-height: 38px; font-size: 16px;}
li .content .arrow_wrap_inner .arrow{width: 38px; height:38px; line-height: 38px; font-size: 16px;}
.arrow_wrap_outer{height:65px; line-height: 65px; font-size: 22px;}
.arrow_wrap_outer .arrow{width:65px;height:65px; line-height: 65px; font-size: 22px;}
li .content .arrow_wrap_inner .arrow_text.learn-more{display: none;}
li .content .arrow_wrap_inner .arrow_text.nxt{display: block;}
.arrow_text{max-width: calc(100% - 38px);}
}

@media screen and (max-width:400px) {
.container .top_wrap .image_wrap{width: 100%;}
} */
.mobileContainer{
  display: none;
}
 @media screen and (max-width:599px) {
.mobileContainer{
  display: block;
}
.desktopContainer{
  display: none;
}
  body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            text-align: center;
            overflow-x: hidden;
            background-color: #000;
            color: #fff;
        }
        
        .page-header {
            color: #fff;
            padding: 10px;
            margin: 0;
            background-color: #000;
        }
        
        .video-wrapper {
            width: 100%;
            height: auto;
            position: relative;
        }
        
        .video-element {
            width: 100%;
            height: auto;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .video-controls-info {
            margin: 15px;
            background-color: #000;
            color: #fff;
        }

        /* Story Progress Indicator */
        .story-progress-container {
            display: flex;
            width: 100%;
            height: 2px;
            position: fixed;
            top: 4px;
            left: 0;
            z-index: 10;
            padding: 0 2px;
            background-color: transparent;
            gap: 2px;
        }

        .progress-segment {
            height: 4px;
            background-color: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            margin: 0 4px;
            flex-grow: 1;
            position: relative;
        }

        .progress-segment-fill {
            height: 100%;
            width: 0%;
            background-color: #ffffff;
            border-radius: 2px;
            transition: none;
        }

        .stories-main-container {
            position: relative;
            height: 100vh;
            height: calc(var(--vh, 1vh) * 100);
            width: 100vw;
            overflow: hidden;
        }
        
        .story-slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
            z-index: 1;
            display: none;
        }
        
        .story-slide.is-active {
            opacity: 1;
            z-index: 2;
            display: block;
        }
        
        /* Call-to-Action Button */
        .primary-cta-button {
            position: absolute;
            bottom: 5%; /* Percentage-based positioning */
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 30px;
            font-size: 16px;
            z-index: 100;
            background-color: rgba(75, 85, 165, 0.9);
            color: rgb(255, 255, 255);
            font-weight: bold;
            border-radius: 30px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            cursor: pointer;
            animation: buttonJumpAnimation 1.5s ease-in-out infinite;
            border: none;
            outline: none;
            /* Responsive font size */
            font-size: clamp(14px, 3vw, 18px);
            /* Responsive padding */
            padding: clamp(10px, 2vw, 15px) clamp(20px, 4vw, 35px);

            /* change for cta button  */
            display: none; /* Hide button initially */
        }

        @media (max-height: 600px) {
            .primary-cta-button {
                bottom: 20px; /* Fixed distance for smaller height screens */
                padding: 8px 20px;
                font-size: 14px;
            }
        }
        
        @media (min-height: 800px) {
            .primary-cta-button {
                bottom: 8%; /* More space on taller screens */
            }
        }

        /* Final Overlay Screen with Heartbeat Effect */
        .final-overlay-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            height: calc(var(--vh, 1vh) * 100);
            background: linear-gradient(to bottom, 
                rgba(0, 0, 0, 0.4) 0%, 
                rgba(0, 0, 0, 0.5) 25%,
                rgba(0, 0, 0, 0.7) 50%,
                rgba(0, 0, 0, 0.8) 75%,
                rgba(0, 0, 0, 0.9) 100%);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transform: translateY(100%);
            transition: opacity 0.8s cubic-bezier(0.4, 0, 0.2, 1), transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 25;
            padding: 20px;
            box-sizing: border-box;
            text-align: center;
            pointer-events: none;
        }

        .final-overlay-screen.is-active {
            opacity: 1;
            transform: translateY(0);
            z-index: 25;
            pointer-events: auto;
        }

        .final-overlay-content {
            max-width: 80%;
            padding: 0;
            transform: translateY(30px);
            opacity: 0;
            transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1) 0.2s, opacity 0.8s cubic-bezier(0.4, 0, 0.2, 1) 0.2s;
        }

        .final-overlay-screen.is-active .final-overlay-content {
            transform: translateY(0);
            opacity: 1;
        }

        .final-overlay-title {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 20px;
            color: white;
            line-height: 1.2;
            cursor: pointer;
        }

        .final-overlay-description {
            font-size: 18px;
            margin-bottom: 40px;
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.5;
            cursor: pointer;
        }

        .final-overlay-cta-button {
            background-color: rgba(75, 85, 165, 0.9);
            color: white;
            font-weight: bold;
            padding: 15px 40px;
            border-radius: 30px;
            font-size: 20px;
            cursor: pointer;
            border: none;
            outline: none;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            transition: transform 0.3s ease, background-color 0.3s ease;
            margin-top: 20px;
        }
        
        .final-overlay-swipe-hint {
            position: absolute;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255, 255, 255, 0.8);
            font-size: 16px;
            font-weight: 500;
            text-align: center;
            opacity: 0;
            transition: opacity 0.5s ease 0.5s;
            pointer-events: none;
            max-width: 80%;
            line-height: 1.4;
        }
        
        .final-overlay-screen.is-active .final-overlay-swipe-hint {
            opacity: 1;
        }
        
        @keyframes buttonJumpAnimation {
            0%, 100% {
                transform: translateX(-50%) translateY(0);
            }
            50% {
                transform: translateX(-50%) translateY(-10px);
            }
        }
        
        @media (max-width: 768px) {
            body {
                padding: 0;
                margin: 0;
                overflow: hidden;
                height: 100%;
                width: 100%;
                position: fixed;
            }
            
            .page-header {
                font-size: 1.2rem;
                padding: 5px;
                display: none; /* Hide header on mobile */
            }
            
            .video-wrapper {
                height: 100%; /* Changed from 100vh to 100% */
                width: 100%;
                position: fixed;
                top: 0;
                left: 0;
                z-index: 1;
                background-color: #000;
                display: flex;
                align-items: center;
                justify-content: center;
                margin: 0;
                padding: 0;
                overflow: hidden;
            }
            
            .video-element {
                width: 100%;
                height: 100%;
                object-fit: contain;
                background-color: #000;
                position: relative;
                top: 0;
                left: 0;
                margin: 0;
                padding: 0;
            }
            
            .video-controls-info {
                display: none; /* Hide controls message on mobile */
                position: fixed;
                bottom: 0;
                width: 100%;
                background: rgba(0, 0, 0, 0.5);
                color: white;
                padding: 10px 0;
                z-index: 2;
            }
        }
        .mobileAnchor{
          overflow: unset;
        }
 }

 @keyframes fadePulse {
    0%, 100% {
        opacity: 1;
    }
    50% {
        opacity: 0.8;
    }
}
@keyframes overlayHeartbeatPulse {
    0%, 100% {
        transform: scale(1);
    }
    50% {
        transform: scale(1.04);
    }
    75% {
        transform: scale(1.02);
    }
}
@keyframes rotatePulse {
    0%, 100% {
        transform: rotate(0deg) scale(1);
    }
    50% {
        transform: rotate(2deg) scale(1.02);
    }
}

.final-overlay-title,
.final-overlay-description,
.final-overlay-cta-button {
    animation: overlayHeartbeatPulse 1.5s infinite;
}

.final-overlay-title .b-text,
.final-overlay-description .b-text {
    color: rgb(244, 155, 155);
    font-weight: bold;
}

/* Loader */



/* Loading Spinner Styles */
.loading-container {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 15px;
    z-index: 2;
}

.loading-spinner {
    width: 40px;
    height: 40px;
    border: 3px solid rgba(255, 255, 255, 0.3);
    border-radius: 50%;
    border-top-color: #fff;
    animation: spin 1s ease-in-out infinite;
}

.loader-message {
    color: #fff;
    font-size: 16px;
    font-weight: 500;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    text-align: center;
    max-width: 280px;
}

.loader-message p {
    margin: 8px 0;
    line-height: 1.4;
}

.loader-message p:first-child {
    font-weight: 600;
}

.loader-message p:last-child {
    font-weight: 400;
    opacity: 0.9;
}

/* Tap to Play Styles */
.tap-to-play-container {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    display: none;
    flex-direction: column;
    align-items: center;
    gap: 20px;
    z-index: 3;
    background: rgba(0, 0, 0, 0.8);
    padding: 30px;
    border-radius: 15px;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    cursor: pointer;
    transition: transform 0.2s ease;
}

.tap-to-play-container:active {
    transform: translate(-50%, -50%) scale(0.95);
}

.play-icon {
    width: 60px;
    height: 60px;
    background: rgba(255, 255, 255, 0.9);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    color: #000;
    animation: playIconPulse 2s ease-in-out infinite;
}

.tap-to-play-message {
    color: #fff;
    font-size: 18px;
    font-weight: 600;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
    text-align: center;
    max-width: 250px;
    line-height: 1.4;
}

.tap-to-play-subtitle {
    color: rgba(255, 255, 255, 0.8);
    font-size: 14px;
    font-weight: 400;
    text-align: center;
    margin-top: 5px;
}

@keyframes playIconPulse {
    0%, 100% {
        transform: scale(1);
        opacity: 0.9;
    }
    50% {
        transform: scale(1.1);
        opacity: 1;
    }
}

@keyframes spin {
    to {
        transform: rotate(360deg);
    }
}

</style>
<script>
    function getUrlParameter(name) {
      const query = window.location.search.substring(1); // Get the query string without the leading "?"
      const params = query.split('&'); // Split query string into key-value pairs
  
      for (let param of params) {
          const [key, value] = param.split('='); // Separate each key-value pair
          if (key === name) {
              return value ? decodeURIComponent(value) : null;
          }
      }
      return null;
    }
  
    function renderBackgroundImage() {
        const mmAssetParam = getUrlParameter('mm_asset');
        if (mmAssetParam) { // Check if parameter exists
            try {
                const jsonObject = JSON.parse(atob(mmAssetParam));
                const imageUrl = jsonObject.img_url;
                if (imageUrl) {
                    const imageWrapElement = document.querySelector('.image_wrap');
                    if (imageWrapElement) { // Check if element exists
                        imageWrapElement.style.backgroundImage = `url('${imageUrl}')`;
                        imageWrapElement.style.backgroundSize = 'cover';
                        imageWrapElement.style.backgroundPosition = 'center';
                        imageWrapElement.style.backgroundRepeat = 'no-repeat';
                    }
                }
            } catch (e) {
                console.error("Invalid mm_asset parameter");
            }
        }
    }
  
    document.addEventListener('DOMContentLoaded', renderBackgroundImage);
  </script>
<script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "hy1edifjih");
</script>
</stl_head>
<stl_body>
<tag:post_form_html />

<div class="wrapper">
    <div class="container d-flex">
        <if:ad_present1>
          <div class="desktopContainer">
            <div class="parentContainer">
            <div class="top_wrap">
                <a href="<ad_href_url:1 />" target="_blank" class="main-anchor img_anchor">
                    <div class="image_wrap desktop_img"></div>
                    <customtag:adClickUrl1 data-type="boolean" />
                </a>
            </div>
            <div class="bottom_wrap">
                    <ul class="list_1">
                        <li>
                            <a href="<ad_href_url:1 />" target="_blank" class="main-anchor">
                                <div class="content"> 
                                    <div class="left_content">
                                        <span class="url"><ad_url_text:1 /></span>
                                        <p class="title"><ad_title_text:1 /></p>
                                        <p class="desc"><ad_desc:1 /></p>
                                    </div>
                                </div>
                            </a>
                        </li>
                    </ul>
            </div>
        </div>    
            <a href="<ad_href_url:1 />" target="_blank" class="main-anchor arw_anchor">
                <div class="arrow_wrap_outer">
                    <p class="arrow_text">NEXT</p>
                    <div class="arrow">&#10140;</div>
                </div>
                <customtag:adClickUrl1 data-type="boolean" />
            </a>
          </div>
          <div class="mobileContainer">
                <div class="story-progress-container">
        <div class="progress-segment">
            <div class="progress-segment-fill" id="progressSegmentOne"></div>
        </div>
    </div>

    <div class="stories-main-container">
        <div class="story-slide is-active" id="storySlideOne">
            <div class="video-wrapper">


                <!-- Loading  -->



                <!-- Loading State -->
                <div class="loading-container" id="loadingContainer">
                    <div class="loading-spinner"></div>
                    <div class="loader-message">
                        
                        <p>Thank you for your interest in eczema treatment options.</p>
                        <p>Loading your personalized healthcare information...</p>
                    </div>
                </div>

                <!-- Tap to Play State -->
                <div class="tap-to-play-container" id="tapToPlayContainer">
                    <div class="play-icon">▶</div>
                    <div class="tap-to-play-message">
                        Tap to Play Video
                        <div class="tap-to-play-subtitle">Learn about FDA-approved eczema treatment</div>
                    </div>
                </div>



                
                <!-- Video element -->
                <video id="videoElementOne" class="video-element" preload="auto" muted playsinline autoplay>
                    <source src="https://staticvideoshost.online/Opzelura%20AD_2.mp4" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
                <button class="primary-cta-button"> Book My Visit →</button>
            </div>
        </div>
    </div>

    <!-- Final Screen with Heartbeat Effect -->
    <div class="final-overlay-screen" id="finalOverlayScreen">
        <div class="final-overlay-content">
            <div class="final-overlay-title">
                Take <span class="b-text">Control</span> of Your Eczema Today
            </div>
            <div class="final-overlay-description">
                Discover how <span class="b-text">FDA-approved treatments</span> are helping thousands find lasting relief from eczema symptoms
            </div>
             <a href="<ad_href_url:1 />" target="_blank" class="main-anchor mobileAnchor">
              <button class="final-overlay-cta-button">
                Book My Visit → 
              </button>
            </a>
        </div>
        <div class="final-overlay-swipe-hint" id="finalOverlaySwipeHint">
            Swipe down to continue watching video
        </div>
    </div>
          </div>
    </if:ad_present1>
    </div>
</div>
<script>
    !function(a, b, c, d, e, f, g)
    {if(a.ctrk)return;e=a.ctrk=function(){e.runner?
    e.runner.apply(e,arguments):e.q.push(arguments)};
    e.q=[];f=b.createElement(c);f.async=true;
    f.src=d+'?d='+a.location.hostname;g=b.getElementsByTagName(c)[0];
    g.parentNode.insertBefore(f,g);}
    (window, document,'script','https://c.pm-srv.co/v1/analytics.js');
    ctrk('boot', '79543636-beb7-404b-9640-966e8b75b986');
    ctrk('record', 'page-land', {dnt: false})
</script>
<script>
         var applicationDestinationUrl ;
        document.addEventListener("DOMContentLoaded", function () {
            const mobileAnchor = document.querySelector(".mobileAnchor");
            if (mobileAnchor) {
                applicationDestinationUrl = mobileAnchor.getAttribute("href");
                console.log("applicationDestinationUrl:", applicationDestinationUrl);
            } else {
                console.warn("No element with class 'mobileAnchor' found.");
            }
        });

 

    // Story functionality
    const storySlide = document.querySelector('.story-slide');
    const videoElement = document.querySelector('.video-element');
    const progressSegment = document.getElementById('progressSegmentOne');
    const finalOverlayScreen = document.getElementById('finalOverlayScreen');
    const loadingContainer = document.getElementById('loadingContainer');
    const tapToPlayContainer = document.getElementById('tapToPlayContainer');
    
    // GA4 Video Load Time Tracking
    const loadStart = performance.now();
    
    // Video timing tracking variables
    let videoStartTime = null;
    let tapToPlayShownTime = null;
    let finalScreenShownTime = null;
    
    // Campaign tracking variable
    const campaign = 'opzelura_ad_video_campaign';
    
    // Autoplay detection variables
    let autoplayTimeout;
    let videoPlayAttempted = false;
    let videoActuallyPlaying = false;
    
    // Animation frame tracking
    let animationFrameId = null;
    
    // Initialize progress bar
    progressSegment.style.width = '0%';
    progressSegment.style.transition = 'width 0.1s linear';
    
    // Function to attempt video play
    function attemptVideoPlay() {
        if (videoPlayAttempted) return;
        videoPlayAttempted = true;
        
        const playPromise = videoElement.play();

        // Clear any existing timeout before setting new one
        if (autoplayTimeout) {
            clearTimeout(autoplayTimeout);
        }
        
        if (playPromise !== undefined) {
            playPromise
                .then(() => {
                    // Video started successfully
                    // console.log("Video autoplay successful");
                })
                .catch(error => {
                    // Autoplay failed
                    // console.log("Video autoplay failed:", error);
                    showTapToPlay();
                });
        }
        
        // Set timeout to detect if video doesn't start playing within 4 seconds
        autoplayTimeout = setTimeout(() => {
            if (!videoActuallyPlaying) {
                console.log("Video didn't start playing within timeout");
                showTapToPlay();
            }
        }, 4000);
    }
    
    // Function to show "Tap to Play" UI
    function showTapToPlay() {
        // If video is already playing OR we know it's actually playing, don't show tap-to-play
        if (videoActuallyPlaying || (!videoElement.paused && !videoElement.ended)) {
            if (tapToPlayContainer) tapToPlayContainer.style.display = 'none';
            if (loadingContainer) loadingContainer.style.display = 'none';
            return;
        }

        if (loadingContainer) {
            loadingContainer.style.display = 'none';
        }
        if (tapToPlayContainer) {
            tapToPlayContainer.style.display = 'flex';
        }

        // Record when tap-to-play screen is shown
        tapToPlayShownTime = performance.now();
        const timeFromPageLoad = Math.round(tapToPlayShownTime - loadStart);
        
        // GA4 Track when tap-to-play screen is shown with enhanced data
        gtag('event', 'tap_to_play_screen_shown', {
            interaction_required: true,
            time_from_page_load_ms: timeFromPageLoad,
            autoplay_failed: true,
            campaign: campaign
        });
    }
    
    // Function to hide all loading/tap UI and start video
    function startVideoPlayback() {

            // If video is already playing, just hide the UI - don't redirect
        if (!videoElement.paused && !videoElement.ended) {
            if (tapToPlayContainer) {
                tapToPlayContainer.style.display = 'none';
            }
            if (loadingContainer) {
                loadingContainer.style.display = 'none';
            }
            const ctaButton = document.querySelector('.primary-cta-button');
            if (ctaButton) {
                ctaButton.style.display = 'block';
            }
            return; // Don't proceed with play logic
        }

        if (loadingContainer) {
            loadingContainer.style.display = 'none';
        }
        if (tapToPlayContainer) {
            tapToPlayContainer.style.display = 'none';
        }
        
        // Clear any existing timeout
        if (autoplayTimeout) {
            clearTimeout(autoplayTimeout);
        }
        
        // Play video if not already playing
        if (videoElement.paused) {
            const playPromise = videoElement.play();
            if (playPromise !== undefined) {
                playPromise.catch(error => {
                    console.log("Manual play failed:", error);
                });
            }
        }
        
        // Note: CTA button will be shown when 'playing' event fires, not here
        animateProgressSegment();
    }
    
    // Video event handlers
    videoElement.addEventListener('loadstart', function() {
        if (loadingContainer) {
            loadingContainer.style.display = 'flex';
        }
        if (tapToPlayContainer) {
            tapToPlayContainer.style.display = 'none';
        }
    });
    
    videoElement.addEventListener('canplay', function() {
        // Try to play video when it's ready
        attemptVideoPlay();
    });
    
    // GA4 Video Load Time Tracking
    videoElement.addEventListener('loadeddata', function() {
        const loadTime = Math.round(performance.now() - loadStart);
        gtag('event', 'video_loaded', {
            load_time_ms: loadTime,
            video_loaded: true,
            campaign: campaign
        });
    });
    
    videoElement.addEventListener('playing', function() {
        videoActuallyPlaying = true;
        // console.log("Video is now playing");
        
        // Record video start time for timing calculations
        if (videoStartTime === null) {
            videoStartTime = performance.now();
        }
        
        // Clear timeout since video is playing
        if (autoplayTimeout) {
            clearTimeout(autoplayTimeout);
        }
        
        // Hide loading/tap UI
        if (loadingContainer) {
            loadingContainer.style.display = 'none';
        }
        if (tapToPlayContainer) {
            tapToPlayContainer.style.display = 'none';
        }
        
        // Show CTA button only when video is actually playing
        const ctaButton = document.querySelector('.primary-cta-button');
        if (ctaButton) {
            ctaButton.style.display = 'block';
        }
        
        animateProgressSegment();
    });
    
    // GA4 Video Completion Tracking
    videoElement.addEventListener('ended', function() {
        gtag('event', 'video_completed', {
            video_completed: true,
            campaign: campaign
        });
        
        // Update swipe hint text if final screen is active
        if (finalOverlayScreen.classList.contains('is-active')) {
            updateSwipeHintText();
        }
    });
    
    videoElement.addEventListener('error', function() {
        if (loadingContainer) {
            const loaderMessage = loadingContainer.querySelector('.loader-message');
            if (loaderMessage) {
                loaderMessage.innerHTML = '<p>Error loading video. Please try again.</p>';
            }
        }
    });
    
    // Tap to Play click handler
    if (tapToPlayContainer) {
        tapToPlayContainer.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            console.log("Tap to play clicked");
            startVideoPlayback();
        });
    }
    
    // GA4 Time-on-Page Milestones
    setTimeout(() => {
        gtag('event', 'engagement_5s', {
            campaign: campaign
        });
    }, 5000);

    setTimeout(() => {
        gtag('event', 'engagement_10s', {
            campaign: campaign
        });
    }, 10000);
    
    // Initialize video
    attemptVideoPlay();
    
    // Additional video functionality
    function updateProgressSegment() {
        const progressPercentage = (videoElement.currentTime / videoElement.duration) * 100;
        progressSegment.style.width = `${progressPercentage}%`;
    }
    
    function displayFinalOverlayScreen() {
        // Check if final screen is already active to prevent duplicate displays
        if (finalOverlayScreen.classList.contains('is-active')) {
            return;
        }
        
        storySlide.classList.add('is-active');
        videoElement.muted = true;
        
        // Pause the video when final overlay screen is shown
        if (!videoElement.paused) {
            videoElement.pause();
        }
        
        // Stop progress animation
        if (animationFrameId) {
            cancelAnimationFrame(animationFrameId);
            animationFrameId = null;
        }
        
        // Record when final screen is shown
        finalScreenShownTime = performance.now();
        
        // Update swipe hint text based on video state
        updateSwipeHintText();
        
        // Add a small delay before showing the overlay for smoother transition
        setTimeout(() => {
            finalOverlayScreen.classList.add('is-active');
        }, 100);
    }
    
    function updateSwipeHintText() {
        const swipeHintElement = document.getElementById('finalOverlaySwipeHint');
        if (swipeHintElement) {
            if (videoElement.ended) {
                swipeHintElement.textContent = 'Swipe down to rewatch video';
            } else {
                swipeHintElement.textContent = 'Swipe down to continue watching video';
            }
        }
    }
    
    function hideFinalOverlayScreen() {
        // Hide the final overlay screen
        finalOverlayScreen.classList.remove('is-active');
        
        // Keep video muted to avoid autoplay restrictions
        // The video can play muted without user interaction
        videoElement.muted = true;
        
        // Check if video has ended - if so, restart from beginning
        if (videoElement.ended) {
            videoElement.currentTime = 0;
            videoElement.play().catch(error => {
                console.log("Error replaying video:", error);
                if (error.name === 'NotAllowedError') {
                    console.log("Autoplay blocked, keeping video muted");
                }
            });
        } else if (videoElement.paused) {
            // Resume video playback if it was paused
            videoElement.play().catch(error => {
                console.log("Error resuming video:", error);
                // If play fails, try with muted state
                if (error.name === 'NotAllowedError') {
                    console.log("Autoplay blocked, keeping video muted");
                }
            });
        }
        
        // Resume progress animation
        animateProgressSegment();
        
        // GA4 Track Final Screen Hidden
        gtag('event', 'final_screen_hidden', {
            campaign: campaign
        });
    }
    
    function animateProgressSegment() {
        // Cancel existing animation before starting new one
        if (animationFrameId) {
            cancelAnimationFrame(animationFrameId);
        }

        function animationStep() {
            // Stop animation if video ended or final screen is active
            if (videoElement.ended || finalOverlayScreen.classList.contains('is-active')) {
                animationFrameId = null;
                return;
            }
            
            updateProgressSegment();
            animationFrameId = requestAnimationFrame(animationStep);
        }
        animationFrameId = requestAnimationFrame(animationStep);
    }

    videoElement.addEventListener('timeupdate', function() {
        if (!finalOverlayScreen.classList.contains('is-active') && 
            this.currentTime >= this.duration * 0.99) {
            displayFinalOverlayScreen();
        }
    });

    // Click handlers for CTA buttons
    document.addEventListener('click', (clickEvent) => {
        if (clickEvent.target.classList.contains('primary-cta-button')) {
            clickEvent.stopPropagation();
            
            // Calculate timing data
            const currentTime = performance.now();
            const timeFromVideoStart = videoStartTime ? Math.round(currentTime - videoStartTime) : null;
            const videoCurrentTime = Math.round(videoElement.currentTime * 1000); // Convert to ms
            const isVideoPlaying = !videoElement.paused && !videoElement.ended;
            
            // GA4 Track Primary CTA Click with enhanced timing data
            gtag('event', 'cta_click', {
                button_position: 'top',
                time_from_video_start_ms: timeFromVideoStart,
                video_current_time_ms: videoCurrentTime,
                video_is_playing: isVideoPlaying,
                video_duration_ms: Math.round(videoElement.duration * 1000),
                campaign: campaign
            });
            window.location.href = applicationDestinationUrl;
        } else if (clickEvent.target.classList.contains('final-overlay-cta-button')) {
            clickEvent.stopPropagation();
            
            // Calculate timing data
            const currentTime = performance.now();
            const timeFromVideoStart = videoStartTime ? Math.round(currentTime - videoStartTime) : null;
            const timeFromFinalScreen = finalScreenShownTime ? Math.round(currentTime - finalScreenShownTime) : null;
            const videoCurrentTime = Math.round(videoElement.currentTime * 1000); // Convert to ms
            
            // GA4 Track Final CTA Click with enhanced timing data
            gtag('event', 'cta_click', {
                button_position: 'final',
                time_from_video_start_ms: timeFromVideoStart,
                time_from_final_screen_ms: timeFromFinalScreen,
                video_current_time_ms: videoCurrentTime,
                video_is_playing: false, // Final screen means video ended
                video_duration_ms: Math.round(videoElement.duration * 1000),
                campaign: campaign
            });
            window.location.href = applicationDestinationUrl;
        }
    });
    
    // Touch/swipe handling
    let touchStartXPosition = 0;
    let touchStartYPosition = 0;
    let touchEndXPosition = 0;
    let touchEndYPosition = 0;
    
    function handleUserSwipeGesture() {
        const horizontalSwipeThreshold = 50;
        const verticalSwipeThreshold = 50;
        
        const horizontalSwipeDistance = touchEndXPosition - touchStartXPosition;
        const verticalSwipeDistance = touchEndYPosition - touchStartYPosition;
        
        // Calculate timing and context data
        const currentTime = performance.now();
        const timeFromVideoStart = videoStartTime ? Math.round(currentTime - videoStartTime) : null;
        const timeFromFinalScreen = finalScreenShownTime ? Math.round(currentTime - finalScreenShownTime) : null;
        const videoCurrentTime = Math.round(videoElement.currentTime * 1000); // Convert to ms
        const isVideoPlaying = !videoElement.paused && !videoElement.ended;
        const isOnFinalScreen = finalOverlayScreen.classList.contains('is-active');
        
        // Swipe up shows final ad screen (if not already shown)
        if (verticalSwipeDistance < -verticalSwipeThreshold) {
            if (!isOnFinalScreen) {
                // Show final overlay screen
                displayFinalOverlayScreen();
                
                // GA4 Track Swipe to Show Final Screen
                gtag('event', 'swipe_to_show_final_screen', {
                    direction: 'up',
                    time_from_video_start_ms: timeFromVideoStart,
                    video_current_time_ms: videoCurrentTime,
                    video_is_playing: isVideoPlaying,
                    video_duration_ms: Math.round(videoElement.duration * 1000),
                    campaign: campaign
                });
            }
            // If already on final screen, swipe up does nothing
            return;
        }
        
        // Swipe down continues the video (hides final screen if shown)
        if (verticalSwipeDistance > verticalSwipeThreshold) {
            if (isOnFinalScreen) {
                // Hide final overlay screen and continue video
                hideFinalOverlayScreen();
                
                // GA4 Track Swipe to Continue Video
                gtag('event', 'swipe_to_continue_video', {
                    direction: 'down',
                    time_from_video_start_ms: timeFromVideoStart,
                    time_from_final_screen_ms: timeFromFinalScreen,
                    video_current_time_ms: videoCurrentTime,
                    video_duration_ms: Math.round(videoElement.duration * 1000),
                    campaign: campaign
                });
            }
            return;
        }
        
        // Swipe left functionality has been removed
    }
    
    // Video pause/resume on touch (only when video is actually playing)
    let userTouchTimeout = null;

    function pauseVideoOnUserHold() {
        // Don't pause if tap-to-play is visible OR if video isn't actually playing yet
        if (!videoActuallyPlaying) {
            return;
        }
        
        // Don't pause if final overlay screen is active
        if (finalOverlayScreen.classList.contains('is-active')) {
            return;
        }
        
        // Additional safety check: don't pause if we're still in loading/tap-to-play state
        if (tapToPlayContainer && tapToPlayContainer.style.display === 'flex') {
            return;
        }
        
        // Only pause if video is actually playing
        if (videoActuallyPlaying && !videoElement.paused) {
            // Clear any existing timeout to prevent multiple pauses
            if (userTouchTimeout) clearTimeout(userTouchTimeout);
            // Set a small timeout to differentiate between tap and hold
            userTouchTimeout = setTimeout(() => {
                if (!videoElement.paused) {
                    videoElement.pause();
                    // GA4 Track Video Pause by User
                    gtag('event', 'video_paused_by_user', {
                        campaign: campaign
                    });
                }
            }, 200); // 200ms delay to detect a hold
        }
    }

    function resumeVideoOnUserRelease() {
        // Clear the timeout in case the hold was too short
        if (userTouchTimeout) {
            clearTimeout(userTouchTimeout);
            userTouchTimeout = null;
        }
        if(finalOverlayScreen.classList.contains('is-active')){
            return;
        }
        
        // Only resume if video was already playing
        if (videoActuallyPlaying && videoElement.paused) {
            try {
                videoElement.play().catch(error => {
                    console.log("Error resuming video:", error);
                });
            } catch (error) {
                console.log("Error trying to play video:", error);
            }
        }
    }

    document.addEventListener('touchstart', touchStartEvent => {
        // Skip if touch is on CTA button
        if (touchStartEvent.target.classList.contains('primary-cta-button') || 
            touchStartEvent.target.classList.contains('final-overlay-cta-button')) {
            return;
        }
        // Skip touch tracking on final screen text elements
        if (touchStartEvent.target.classList.contains('final-overlay-title') || 
            touchStartEvent.target.classList.contains('final-overlay-description')) {
            return;
        }
        // Skip touch interactions on loading/tap to play elements
        if (touchStartEvent.target.closest('.loading-container') || 
            touchStartEvent.target.closest('.tap-to-play-container') ||
            touchStartEvent.target.classList.contains('loading-spinner') ||
            touchStartEvent.target.closest('.loader-message')) {
            return;
        }
        touchStartXPosition = touchStartEvent.changedTouches[0].screenX;
        touchStartYPosition = touchStartEvent.changedTouches[0].screenY;
        pauseVideoOnUserHold();
    });

    document.addEventListener('touchend', touchEndEvent => {
        // Skip if touch is on CTA button
        if (touchEndEvent.target.classList.contains('primary-cta-button') || 
            touchEndEvent.target.classList.contains('final-overlay-cta-button')) {
            return;
        }
        // Skip touch tracking on final screen text elements
        if (touchEndEvent.target.classList.contains('final-overlay-title') || 
            touchEndEvent.target.classList.contains('final-overlay-description')) {
            return;
        }
        // Skip touch interactions on loading/tap to play elements
        if (touchEndEvent.target.closest('.loading-container') || 
            touchEndEvent.target.closest('.tap-to-play-container') ||
            touchEndEvent.target.classList.contains('loading-spinner') ||
            touchEndEvent.target.closest('.loader-message')) {
            return;
        }

        touchEndXPosition = touchEndEvent.changedTouches[0].screenX;
        touchEndYPosition = touchEndEvent.changedTouches[0].screenY;
        resumeVideoOnUserRelease();
        handleUserSwipeGesture();
    });

    document.addEventListener('mousedown', mouseDownEvent => {
        // Skip if the click was on the CTA button
        if (mouseDownEvent.target.classList.contains('primary-cta-button')) return;
        // Skip mouse interactions on loading/tap to play elements
        if (mouseDownEvent.target.closest('.loading-container') || 
            mouseDownEvent.target.closest('.tap-to-play-container') ||
            mouseDownEvent.target.classList.contains('loading-spinner') ||
            mouseDownEvent.target.closest('.loader-message')) {
            return;
        }
        pauseVideoOnUserHold();
    });

    document.addEventListener('mouseup', mouseUpEvent => {
        // Skip if the click was on the CTA button
        if (mouseUpEvent.target.classList.contains('primary-cta-button')) return;
        // Skip mouse interactions on loading/tap to play elements
        if (mouseUpEvent.target.closest('.loading-container') || 
            mouseUpEvent.target.closest('.tap-to-play-container') ||
            mouseUpEvent.target.classList.contains('loading-spinner') ||
            mouseUpEvent.target.closest('.loader-message')) {
            return;
        }
        resumeVideoOnUserRelease();
    });
</script>
</stl_body>
</html>
